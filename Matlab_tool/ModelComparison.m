clearvars
close all
clc

set(groot, 'defaultAxesTickLabelInterpreter','latex');
set(groot, 'defaultLegendInterpreter','latex');
set(groot, 'defaultAxesFontSize',30);
set(groot, 'defaultAxesFontWeight','bold');
set(groot, 'defaultLegendLocation','northwest');

t0 = [.00635, .005334, .004572, .003302, .00254, ...
                  .001651, .01905, .01524, .0127, .009525, .00508, .00254];
a = -0.4;
b = 0.4;              

% t(1,:) = t0;
% dd(1) = mean((t(1,:)-t0)./t0);
% 
% for i = 2:10
% t(i,:) = t0 + t0.*(a + (b-a).*rand(1,12));
% dd(i) = mean((t(i,:)-t0)./t0);
% end
% [dd,idx] = sort(dd);
% t = t(idx,:);
t = [ 0.004961329765633,   0.005482633871192,   0.003802019847306,   0.002161808562691,   0.001696660554992,   0.001080862769511,  0.017675603447054   ,0.010648265813116  , 0.012121048581448,   0.012564920795668,   0.004485188903257,   0.001768201938931; ...
   0.006701084009254,   0.006934339649947,   0.004018147836255,   0.002091938526567,   0.001813234309797,   0.001091763816305  ,   0.022715625220946 ,  0.014709954352273 ,  0.014409413043606 ,  0.011043255096096 ,  0.005369995711156 ,  0.002801504870851; ...
   0.005848196873186,   0.005449127998566,   0.006013956549225,   0.004037317515000,   0.001664954968623,   0.001358818605403  ,   0.017211596280616 ,  0.019686087685502 ,  0.011886797353213 ,  0.007542866348008 ,  0.005476867954705 ,  0.002498149748119; ...
   0.006777242477279,   0.004919874971812,   0.004608723539382,   0.003290493769135,   0.002847580472024,   0.001972887075818 ,    0.016031770869499 ,  0.010236548713984 ,  0.016011809302040 ,  0.008683653007983 ,  0.006198838923685 ,  0.001888478001617; ...
   0.006350000000000,   0.005334000000000,   0.004572000000000,   0.003302000000000,   0.002540000000000,   0.001651000000000  ,  0.019050000000000  , 0.015240000000000  , 0.012700000000000  , 0.009525000000000  , 0.005080000000000  , 0.002540000000000; ...
   0.008497384222097,   0.005608214196116,   0.004321315607519,   0.002873650203582,   0.002988510005386,   0.001008636272449 ,    0.017130677337904 ,  0.020393378207021 ,  0.013172233223977 ,  0.009326017947511 ,  0.005065927662141 ,  0.002151829237038; ...
   0.006374437964957,   0.005282790862614,   0.004564093399108,   0.004453673021662,   0.002315020379443,   0.001145325334893 ,   0.015094054962522  , 0.017494404366519 ,  0.016146816729005 ,  0.013107502102683  , 0.003922449306436  , 0.003069017679922; ...
   0.008269040739457,   0.006026787343341,   0.005945112826793,   0.003216192956963,   0.001811194809580,   0.001080591991113, 0.022315054281459  , 0.012898965655607   ,0.014439025952589  , 0.010686446765918  , 0.005206182479034  , 0.002977097488541; ...
   0.008374621309323,   0.007188991260026,   0.005734702883348,   0.003853853958667,   0.003034224199062,   0.002178936680748,    0.012424254625757 ,  0.013239429001049 ,  0.007664044337705 ,  0.012025088495998 ,  0.005110217373360 ,  0.002268042070255; ...
   0.004365554945366,   0.007062891660305,   0.005948541431947,   0.004622252038237,   0.003280165522068,   0.001039307831433,    0.019730960416190 ,  0.021306936493182 ,  0.012811842847140 ,  0.012371162780630 ,  0.003333380063576  , 0.003530678713234];

dd = mean((t-t0)./t0,2);
mm = max((t-t0)./t0,[],2);
for i = 1:10
hh(i) = dot(t(i,:)/norm(t(i,:)),t0/norm(t0));
nn(i) = norm((t(i,:)-t0)./t0);
end


[hh,idx2] = sort(hh);
t = t(idx2,:);
dd = dd(idx2,:);
%LF

Cl_LF = [0.46346  0.47639   0.48602  0.47729  0.47904 0.48145   0.48417 0.48909 0.49394 0.49809];
Cdi_LF = [0.00811  0.00848   0.00869  0.00841  0.00849 0.00858  0.00861 0.00879 0.0089 0.00901];
VMmax_LF = [255406900.0  247768700.0   241041600.0  246248000.0 249604000.0 252586600.0  246171800.0 226295400.0  243026500.0 228266500.0];
tip_LF = [7.570739 7.495539  7.472894999999999 7.5242  7.528452 7.4898880000000005  7.478051 7.430007 7.42667 7.433063];

Cl_LF = Cl_LF(idx2);
CDi_LF = Cdi_LF(idx2);
VMmax_LF = VMmax_LF(idx2);
tip_LF = tip_LF(idx2);

%HF

Cl_HF = [0.45813  0.47079 0.47956 0.47154 0.47302 0.47523 0.47836  0.4836 0.48823 0.49183];
Cdi_HF = [0.00804  0.0084 0.00856 0.00831 0.00837 0.00846 0.0085  0.00868 0.00877 0.00886];
VMmax_HF = [262857860.79763716 256624731.15570116  241599500.0 248752600.0 254666100.0 259052700.0 251392900.0 224877100.0 245455100.0 231388800.0];
tip_HF = [7.613441   7.540098 7.52586 7.567221 7.57714 7.543068 7.531462  7.473547 7.457318000000001 7.481403];

Cl_HF = Cl_HF(idx2);
CDi_HF = Cdi_HF(idx2);
VMmax_HF = VMmax_HF(idx2);
tip_HF = tip_HF(idx2);

%covariances

Cov_cl = corrcoef(Cl_LF/norm(Cl_LF),Cl_HF/norm(Cl_HF))
Cov_cd = corrcoef(Cdi_LF/norm(Cdi_LF),Cdi_HF/norm(Cdi_HF))
Cov_vm = corrcoef(VMmax_LF/norm(VMmax_LF),VMmax_HF/norm(VMmax_HF))
Cov_tip = corrcoef(tip_LF/norm(tip_LF),tip_HF/norm(tip_HF))

Max_cl = max(max(abs(Cl_LF-Cl_HF)))/Cl_HF(end)*100
Max_cdi = max(max(abs(Cdi_LF-Cdi_HF)))/Cdi_HF(end)*100
Max_VM = max(max(abs(VMmax_LF-VMmax_HF)))/VMmax_HF(end)*100
Max_tip = max(max(abs(tip_LF-tip_HF)))/tip_HF(end)*100

min_cl = min(min(abs(Cl_LF-Cl_HF)))/Cl_HF(end)*100
min_cdi = min(min(abs(Cdi_LF-Cdi_HF)))/Cdi_HF(end)*100
min_VM = min(min(abs(VMmax_LF-VMmax_HF)))/VMmax_HF(end)*100
min_tip = min(min(abs(tip_LF-tip_HF)))/tip_HF(end)*100

% plot

figure()
hold on
plot(hh,Cl_LF,'*-','Color',[0 0.4470 0.7410],'LineWidth',1.5)
plot(hh,Cl_HF,'*-','Color',[0.9290 0.6940 0.1250],'LineWidth',1.5)
xlabel('Normalized vector projection','Interpreter','latex')
ylabel('Cl','Interpreter','latex')
legend('Cl LF','Cl HF','Interpreter','latex')
xlim([0.955 1.001])
grid minor

ytlblstr = sprintf('0.008\n 0.0083\n 0.0086\n 0.0089\n 0.0092\n');
ytlbls = regexp(ytlblstr, '\n', 'split');

figure()
hold on
plot(hh,Cdi_LF,'*-','Color',[0 0.4470 0.7410],'LineWidth',1.5)
plot(hh,Cdi_HF,'*-','Color',[0.9290 0.6940 0.1250],'LineWidth',1.5)
xlabel('Normalized vector projection','Interpreter','latex')
ylabel('Cdi','Interpreter','latex')
legend('Cdi LF','Cdi HF','Interpreter','latex')
set(gca, 'YTick',[0.008:0.0003:0.0092], 'YTickLabel', ytlbls)
xlim([0.955 1.001])
grid minor

figure()
hold on
plot(hh,VMmax_LF/10^6,'*-','Color',[0 0.4470 0.7410],'LineWidth',1.5)
plot(hh,VMmax_HF/10^6,'*-','Color',[0.9290 0.6940 0.1250],'LineWidth',1.5)
xlabel('Normalized vector projection','Interpreter','latex')
ylabel('VMmax [MPa]','Interpreter','latex')
legend('VMmax LF','VMmax HF','Interpreter','latex')
xlim([0.955 1.001])
grid minor

figure()
hold on
plot(hh,tip_LF,'*-','Color',[0.9290 0.6940 0.1250],'LineWidth',1.5)
plot(hh,tip_HF,'*-','Color',[0 0.4470 0.7410],'LineWidth',1.5)
xlabel('Normalized vector projection','Interpreter','latex')
ylabel('Tip displacement [m]','Interpreter','latex')
legend('Tip disp LF','Tip disp HF','Interpreter','latex')
xlim([0.955 1.001])
grid minor

